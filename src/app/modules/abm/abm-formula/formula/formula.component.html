<div class="flex flex-col w-full" id="top">
  <!-- mode: Edit || Create. -->
  <div class="grid border-2 bg-white border-gray-200 rounded-2xl m-8 p-8" *ngIf="mode === 'Edit' || mode === 'Create'">
    <div>
      <h1 class="text-2xl font-semibold mb-2"> Fórmula </h1>
    </div>

    <form class="mt-4" [formGroup]="form">
      <div class="flex gap-6" *ngIf="mode === 'Edit'">
        <mat-form-field class="w-full">
          <input matInput [formControlName]="'version'">
        </mat-form-field>
        <mat-form-field class="w-full">
          <input matInput [formControlName]="'date'">
        </mat-form-field>
      </div>
      <mat-form-field class="w-full">
        <!-- <mat-icon svgIcon="mat_solid:account_circle" class="mr-3"></mat-icon> -->
        <input matInput [formControlName]="'name'" placeholder="Nombre">
        <mat-error class="mb-1" *ngIf="form.get('name').hasError('required')">
          El nombre es requerido.
        </mat-error>
        <mat-error class="mb-1" *ngIf="form.get('name').hasError('minlength')">
          Mínimo 3 caracteres.
        </mat-error>
        <mat-error class="mb-1" *ngIf="form.get('name').hasError('maxlength')">
          Máximo 100 caracteres.
        </mat-error>
      </mat-form-field>

      <mat-form-field class="w-full">
        <!-- <mat-icon svgIcon="mat_solid:account_circle" class="mr-3"></mat-icon> -->
        <mat-select [formControlName]="'material'" *ngIf="mode === 'Create' || mode === 'Edit'; else viewMode"
          [placeholder]="(!materials$ && !materialsFail) ? 'Materiales: Cargando...' : ((!materials$ && materialsFail) ? 'No se ha podido cargar la lista de materiales' : 'Materiales')">
          <mat-option *ngFor="let material of materials$" [value]="material.id">
            {{ material.nombre }}
          </mat-option>
        </mat-select>
        <mat-error class="mb-1" *ngIf="form.get('material').hasError('required')">
          El material es requerido.
        </mat-error>
        <ng-template #viewMode>
          <input matInput [formControlName]="'material'" placeholder="Material">
        </ng-template>
      </mat-form-field>

      <mat-form-field class="w-full">
        <!-- <mat-icon svgIcon="mat_solid:account_circle" class="mr-3"></mat-icon> -->
        <input matInput [formControlName]="'norma'" placeholder="Norma">
        <mat-error class="mb-1" *ngIf="form.get('norma').hasError('required')">
          La norma es requerida.
        </mat-error>
        <mat-error class="mb-1" *ngIf="form.get('norma').hasError('minlength')">
          Mínimo 3 caracteres.
        </mat-error>
        <mat-error class="mb-1" *ngIf="form.get('norma').hasError('maxlength')">
          Máximo 100 caracteres.
        </mat-error>
      </mat-form-field>
    </form>

  </div>

  <!-- mode: Test. -->
  <div class="flex-auto p-6 sm:p-10">
    <table mat-table [dataSource]="machines$" class="border-2 rounded-2xl mt-5 w-full">
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef> Maquina </th>
        <td mat-cell *matCellDef="let element"> {{ element.nombre }} </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>
</div>